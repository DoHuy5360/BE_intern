<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="stylesheet" href="../css/changePassword.css" />
		<title>Change Password</title>
	</head>
	<body>
		<div class="grid_center">
			<form id="change-password-form">
				<h2>Change Password</h2>
				<div id="inner-wrap">
					<div class="wrap_input">
						<label class="input_label" for="setnew-pws">New Password</label>
						<input id="setnew-pws" type="password" required />
					</div>
					<div class="wrap_input">
						<label class="input_label" for="retype-pws">Retype New Password</label>
						<input id="retype-pws" type="password" required />
					</div>
				</div>
				<button id="form-submit" type="submit">Submit</button>
			</form>
		</div>
	</body>
</html>
<script>
	document.addEventListener("DOMContentLoaded", (e) => {
		const form = document.querySelector("#change-password-form");
		const setnewPws = document.querySelector("#setnew-pws");
		const retypePws = document.querySelector("#retype-pws");
		form.addEventListener("submit", (e) => {
			e.preventDefault();
			var currentUrl = window.location.href;
			var url = new URL(currentUrl);
			const body = {
				accountPassword: setnewPws.value,
				retypeAccountPassword: retypePws.value,
			};
			const token = url.searchParams.get("certificate");
			fetch("/api/v2/account/change-password", {
				method: "PUT",
				headers: {
					Authorization: `Bearer ${token}`,
					"Content-Type": "application/json",
				},
				body: JSON.stringify(body),
			})
				.then((res) => res.json())
				.then((body) => {
					body.status === "OK" ? alert("Success") : alert("Fail");
				});
		});
	});
</script>
